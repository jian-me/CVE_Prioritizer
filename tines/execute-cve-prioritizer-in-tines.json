{
  "schema_version": 26,
  "standard_lib_version": 80,
  "action_runtime_version": 32,
  "name": "Pull a Python Script from Github to execute in Tines",
  "description": "When executing a python script in Tines, you can maintain your organizations controls on code by calling out to the repository of your choice, and then executing the script.",
  "guid": "fafa01a984a7db2233986669d3291408",
  "slug": "pull_a_python_script_from_github_to_execute_in_tines",
  "agents": [
    {
      "type": "Agents::HTTPRequestAgent",
      "name": "Get Github Repository Contents",
      "disabled": false,
      "description": null,
      "guid": "ffeba6674110a3369e2c2898e15f5768",
      "origin_story_identifier": "cloud:d521f765a49c72507257a2620612ee96:810599114b549619ad4dcbdd3c9afb5c",
      "options": {
        "url": "https://api.github.com/repos/<<set_gh_variables.owner>>/<<set_gh_variables.repository>>/contents/<<set_gh_variables.filepath>>",
        "content_type": "json",
        "method": "get",
        "headers": {
          "Authorization": "token <<CREDENTIAL.github>>"
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "template": {
        "created_from_template_guid": null,
        "created_from_template_version": null,
        "template_tags": []
      },
      "width": null,
      "schedule": null
    },
    {
      "type": "Agents::EventTransformationAgent",
      "name": "Set GH variables",
      "disabled": false,
      "description": null,
      "guid": "1226b709d8bfa120c2c84ad906dbdcd4",
      "origin_story_identifier": "cloud:d521f765a49c72507257a2620612ee96:810599114b549619ad4dcbdd3c9afb5c",
      "options": {
        "mode": "message_only",
        "loop": false,
        "payload": {
          "owner": "<<RESOURCE.github_repo_owner>>",
          "repository": "<<RESOURCE.github_repo>>",
          "filepath": "<<RESOURCE.script_file_path>>"
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "template": {
        "created_from_template_guid": null,
        "created_from_template_version": null,
        "template_tags": []
      },
      "width": null,
      "schedule": null
    },
    {
      "type": "Agents::EventTransformationAgent",
      "name": "Decode Script",
      "disabled": false,
      "description": null,
      "guid": "3fe6537b8f185f0fde70be9dcc8c24cf",
      "origin_story_identifier": "cloud:d521f765a49c72507257a2620612ee96:810599114b549619ad4dcbdd3c9afb5c",
      "options": {
        "mode": "message_only",
        "loop": false,
        "payload": {
          "script": "<<BASE64_DECODE(STRIP_NEWLINES(get_github_repository_contents.body.content))>>"
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "template": {
        "created_from_template_guid": null,
        "created_from_template_version": null,
        "template_tags": []
      },
      "width": null,
      "schedule": null
    },
    {
      "type": "Agents::EventTransformationAgent",
      "name": "Output",
      "disabled": false,
      "description": null,
      "guid": "3eac80ca94baa0dc57cfdd605f0653a1",
      "origin_story_identifier": "cloud:d521f765a49c72507257a2620612ee96:810599114b549619ad4dcbdd3c9afb5c",
      "options": {
        "mode": "message_only",
        "loop": false,
        "payload": "=run_python_script.output"
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "template": {
        "created_from_template_guid": null,
        "created_from_template_version": null,
        "template_tags": []
      },
      "width": null,
      "schedule": null
    },
    {
      "type": "Agents::RunScriptAgent",
      "name": "Run Python Script",
      "disabled": false,
      "description": "A method for running Python functions in Tines. Define your script inside the script option, if needed, declare your dependencies in the requirements option. Script must contain a 'main' function. ",
      "guid": "c017ec99baab861f0e76f2e64fbd8189",
      "origin_story_identifier": "cloud:d521f765a49c72507257a2620612ee96:810599114b549619ad4dcbdd3c9afb5c",
      "options": {
        "language": "python",
        "script": "<<decode_script.script>>",
        "input": {
          "nist_api_key": "<<CREDENTIAL.nist_api>>",
          "vulncheck_api_key": "<<CREDENTIAL.vulncheck_api>>",
          "cve": "<<global_variables.cve>>",
          "epss_threshold": "=global_variables.epss_threshold",
          "cvss_threshold": "=global_variables.cvss_threshold",
          "use_nvd_plus": "=global_variables.use_nvd_plus",
          "use_vulncheck_kev": "=global_variables.use_vulncheck_kev"
        },
        "timeout": "10",
        "requirements": "click>=8.0.3\npandas>=1.5.3\npython-dotenv>=0.19.2\nrequests>=2.32.3\ntermcolor>=2.2.0"
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "template": {
        "created_from_template_guid": "94d07f18c162d3fdd4cea959c1ea1c93e49129ea6eedad1b83edc4d2a14480af",
        "created_from_template_version": null,
        "template_tags": []
      },
      "width": null,
      "schedule": null
    },
    {
      "type": "Agents::EventTransformationAgent",
      "name": "Global Variables",
      "disabled": false,
      "description": null,
      "guid": "2d7a0fc7a3202ec3ae126a796925ff87",
      "origin_story_identifier": "cloud:d521f765a49c72507257a2620612ee96:810599114b549619ad4dcbdd3c9afb5c",
      "options": {
        "mode": "message_only",
        "loop": false,
        "payload": {
          "cve": "<<webhook_action.body.cve>>",
          "epss_threshold": "=IF(IS_BLANK(RESOURCE.epss_threshold),0.2,RESOURCE.epss_threshold)",
          "cvss_threshold": "=IF(IS_BLANK(RESOURCE.cvss_threshold),6,RESOURCE.cvss_threshold)",
          "use_vulncheck_kev": "=IF(IS_BLANK(RESOURCE.use_vulncheck_kev),FALSE,RESOURCE.use_vulncheck_kev)",
          "use_nvd_plus": "=IF(IS_BLANK(RESOURCE.use_nvd_plus),FALSE,RESOURCE.use_nvd_plus)"
        }
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "template": {
        "created_from_template_guid": null,
        "created_from_template_version": null,
        "template_tags": []
      },
      "width": null,
      "schedule": null
    },
    {
      "type": "Agents::WebhookAgent",
      "name": "Webhook Action",
      "disabled": false,
      "description": null,
      "guid": "100d08998a7ff79c8f8019709f9d5acf",
      "origin_story_identifier": "cloud:919b3cc601f53832b88d5df87b88d28b:fafa01a984a7db2233986669d3291408",
      "options": {
        "path": "f313b06d3ff831fbf73e8b7276f1303f",
        "secret": "edd06536f6b844899fffd83340131aac",
        "verbs": "get,post"
      },
      "reporting": {
        "time_saved_value": 0,
        "time_saved_unit": "minutes"
      },
      "monitoring": {
        "monitor_all_events": false,
        "monitor_failures": false,
        "monitor_no_events_emitted": null
      },
      "template": {
        "created_from_template_guid": null,
        "created_from_template_version": null,
        "template_tags": []
      },
      "width": null
    }
  ],
  "diagram_notes": [
    {
      "content": "# **Requirements**\n\n## **Credentials**\n - [ ] `github` - Tines [GitHub](https://explained.tines.com/en/articles/8052219-github-oauth-authentication-guide) credential\n- [ ] `nist_api` - [NIST NVD API](https://github.com/TURROKS/CVE_Prioritizer) token\n- [ ] `vulncheck_api` - [VulnCheck API](https://github.com/TURROKS/CVE_Prioritizer) token\n\n## **Resources**\n - [ ] `github_repo_owner` - GitHub username of repository owner\n - [ ] `github_repo` - GitHub repository name\n- [ ] `script_file_path` - Path to script on GitHub\n- [ ] `epss_threshold` - EPSS threshold, defaults to 0.2\n- [ ] `cvss_threshold` - CVSS threshold, defaults to 6\n- [ ] `use_vulncheck_kev` - Use VulnCheck KEV flag\n- [ ] `use_nvd_plus` - Use NVD+ flag\n\n## **Inputs**\n- [ ] `cve` - CVE ID",
      "position": [
        -435,
        405
      ],
      "guid": "3ab3f4124155f8f7c6638c603bbaed6e",
      "width": 506
    },
    {
      "content": "# **Description**\n\nThis story pulls and runs the Python script from your GitHub repository to retrieve CVSS and prioritization from the designated database.\n\nThe story uses modified code from https://github.com/TURROKS/CVE_Prioritizer to prioritize the CVE.\n\nDefault file, use:\n\n`cve_prioritizer/cve_prioritizer_tines.py`\n\nThe output should be a JSON object with the following fields:\n\n```\n\"output\": [\n      {\n        \"cve_id\": \"CVE-2024-0001\",\n        \"priority\": \"P2\",\n        \"epss\": 0.00159,\n        \"cvss_base_score\": 10.0,\n        \"cvss_version\": \"CVSS V31\",\n        \"cvss_severity\": \"CRITICAL\",\n        \"kev\": \"FALSE\",\n        \"kev_source\": \"CISA\",\n        \"cpe\": \"cpe:2.3:a:purestorage:purity\\\\/\\\\/fa:*:*:*:*:*:*:*:*\",\n        \"vector\": \"CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H\"\n      }\n    ]\n```",
      "position": [
        -435,
        -135
      ],
      "guid": "34d4905c1e3f1c5ded54c7f27bc39da2",
      "width": 507
    },
    {
      "content": "# Global Variables & Inputs\nSet your input, this can be from actions upstream in your story. If another story calls this story, then make sure you only send one CVE at a time through the Webhook Action. You may need to use an Explode action before you call this story.",
      "position": [
        390,
        -240
      ],
      "guid": "b422e6085dda7cf4738f13fecce9b997",
      "width": 270
    },
    {
      "content": "# Decode\nDecode the Base64 contents received from Github",
      "position": [
        390,
        240
      ],
      "guid": "0aab46bbab880c56be20bdb09d858a90",
      "width": 270
    },
    {
      "content": "# Execute script\nExecute the script, with the desired inputs and Requirements.\n\nYour script can reference the inputs `input[\"<<object_name>>\"]`.\n\nIn this action, note that Input has a key named `hostname`. So, in the script this would be called with `input[\"hostname\"]`. ",
      "position": [
        390,
        360
      ],
      "guid": "7c11fd7db88099058ec7528361330575",
      "width": 270
    }
  ],
  "links": [
    {
      "source": 0,
      "receiver": 2
    },
    {
      "source": 1,
      "receiver": 0
    },
    {
      "source": 2,
      "receiver": 4
    },
    {
      "source": 4,
      "receiver": 3
    },
    {
      "source": 5,
      "receiver": 1
    },
    {
      "source": 6,
      "receiver": 5
    }
  ],
  "diagram_layout": "{\"ffeba6674110a3369e2c2898e15f5768\":[150,105],\"1226b709d8bfa120c2c84ad906dbdcd4\":[150,-15],\"3fe6537b8f185f0fde70be9dcc8c24cf\":[150,240],\"3eac80ca94baa0dc57cfdd605f0653a1\":[150,480],\"c017ec99baab861f0e76f2e64fbd8189\":[150,360],\"2d7a0fc7a3202ec3ae126a796925ff87\":[150,-135],\"100d08998a7ff79c8f8019709f9d5acf\":[150,-240]}",
  "story_library_metadata": {
    "tags": [
      "GitHub",
      "Python",
      "Scripts",
      "Sneak Peek",
      "Technique",
      "Beginner"
    ],
    "icons": [
      "🐍",
      "github",
      "tines"
    ],
    "visibility": "public"
  },
  "monitor_failures": false,
  "synchronous_webhooks_enabled": true,
  "integrations": [],
  "parent_only_send_to_story": false,
  "keep_events_for": 86400,
  "reporting_status": true,
  "send_to_story_enabled": false,
  "entry_agent_guid": null,
  "exit_agent_guids": [],
  "api_entry_action_guids": [
    "100d08998a7ff79c8f8019709f9d5acf"
  ],
  "api_exit_action_guids": [
    "3eac80ca94baa0dc57cfdd605f0653a1"
  ],
  "send_to_story_access": null,
  "send_to_story_access_source": 0,
  "send_to_story_skill_use_requires_confirmation": true,
  "pages": [],
  "tags": [],
  "time_saved_unit": "minutes",
  "time_saved_value": 0,
  "origin_story_identifier": "cloud:d521f765a49c72507257a2620612ee96:810599114b549619ad4dcbdd3c9afb5c",
  "recipients": [
    "npage@tines.io"
  ],
  "integration_product": null,
  "integration_vendor": null,
  "llm_product_instructions": "",
  "send_to_stories": [],
  "exported_at": "2025-03-20T17:52:38Z",
  "icon": ":snake:"
}